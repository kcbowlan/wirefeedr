# Personal News Aggregator - Project Log

## Project Goal
Create a desktop news aggregator that delivers factual news via RSS feeds while filtering out sensationalism, opinion pieces, and propaganda.

**Last Updated:** 2026-02-03
**Status:** v2.4 - SIGNAL Step 1 (MBFC Data Integration)

---

## Technology Stack
| Component | Choice | Reason |
|-----------|--------|--------|
| Language | Python 3 | Simple, readable, good RSS libraries |
| GUI | Tkinter | Built into Python, no installation |
| RSS Parsing | feedparser | Industry standard, handles edge cases |
| HTTP | requests | Simple and reliable |
| Storage | sqlite3 | Built into Python, no installation |

**Packages to install:** `pip install feedparser requests`

---

## Project Structure

```
News Aggregate/
├── News Aggregator.bat      # Windows launcher (double-click to run)
├── PROJECT_LOG.md           # This file
└── news_aggregator/
    ├── main.py              # Entry point (23 lines)
    ├── app.py               # Orchestration, handlers, business logic (~1,100 lines)
    ├── entities.py          # Entity name databases — pure data (~1,330 lines)
    ├── constants.py         # Idle messages, stop words — pure data (~316 lines)
    ├── ui_builders.py       # Widget construction (~746 lines)
    ├── animations.py        # Visual effects, animation loop, boot sequence (~1,278 lines)
    ├── highlighting.py      # Text highlighting, entity detection (~675 lines)
    ├── ticker.py            # Ticker tape, trending split-flap, bias bar (~534 lines)
    ├── dialogs.py           # Dialog windows, instance management (~300 lines)
    ├── window_mgmt.py       # Win32 borderless window, drag/resize (~215 lines)
    ├── feeds.py             # RSS feed fetching/parsing
    ├── storage.py           # SQLite database operations
    ├── filters.py           # Content filtering logic
    ├── config.py            # Default settings, feeds, and bias colors
    ├── mbfc.py              # MBFC data loader and source lookup (~150 lines)
    ├── fetch_mbfc.py        # Script to download/rebuild MBFC data (~80 lines)
    └── data/
        ├── news.db          # SQLite database (auto-created on first run)
        └── mbfc_sources.json # MBFC source ratings (generated by fetch_mbfc.py, ~2.7MB)
```

---

## How to Run

```bash
# Option 1: Double-click the batch file
News Aggregator.bat

# Option 2: Command line
cd news_aggregator
python main.py
```

---

## Features Implemented

### Core Features
- [x] RSS feed fetching and parsing with error handling
- [x] SQLite storage for feeds, articles, settings, and custom keywords
- [x] Sensationalism/noise detection scoring (0-100)
- [x] Opinion content detection (URL patterns, title patterns)
- [x] Clickbait pattern detection
- [x] Custom filter keywords with configurable weights

### GUI Features
- [x] Three-panel layout (feeds tree, article list, preview)
- [x] Feed management (add, remove, validate, organize by category)
- [x] Article list columns: Title, Source, Bias, Date, Noise Level
- [x] Article preview with summary text
- [x] "Open in Browser" button
- [x] "Author Bio" button (links to author profile when available)
- [x] Mark read/unread (automatic on selection)
- [x] Noise filter slider (hide articles above threshold)
- [x] Search functionality
- [x] Auto-refresh (30 minutes default, configurable)
- [x] Right-click context menus on feeds and articles

### Bias Transparency
- [x] Source bias ratings displayed in article list column
- [x] Color-coded bias labels in preview panel:
  - Green = Center
  - Blue = Left-Center
  - Purple = Right-Center
- [x] Color-coded factual ratings:
  - Green = Very High / High
  - Orange = Mostly Factual
  - Red = Mixed
- [x] Author Bio button with auto-generated profile URLs

### Volume Reduction (v1.3)
- [x] **Recency Window** - Dropdown to filter articles by age (6h/12h/24h/48h/Week/All)
- [x] **Smart Daily Cap per Source** - Limit N articles per feed, ranked by quality score
- [x] **Topic Clustering** - Group related articles with [+N] indicator, expandable in preview

### UI Polish (v1.9)
- [x] **Dark Cyberpunk Theme** - Full dark theme with neon cyan/magenta accents (Session 12)
- [x] **Cyberpunk Animations** - Pulsing neon borders, title glow, neon sweep line (Session 13)
- [x] **Summary Highlighting** - Comprehensive entity-based highlighting with Wikipedia links:
  - People (Cyan), Titles (Purple), Government (Slate Blue), Military (Steel Blue)
  - Organizations (Green), Countries (Orange), Places (Sienna), Events (Goldenrod)
  - Money (Magenta), Statistics (Hot Pink), Dates (Rose), Numbers (Yellow), Verbs (Coral)
- [x] **Bold Lede** - First sentence bolded for quick scanning
- [x] **Keyboard Navigation** - ↑/↓ navigate, Enter open, M read, H hide, F5 refresh
- [x] **Wikipedia Links** - Clickable entities open Wikipedia search
- [x] **Feed Favicons** - 16x16 icons next to feed names

---

## Default Feeds (with Integrity Ratings)

| Source | Category | Bias | Factual | Author Bio |
|--------|----------|------|---------|------------|
| Associated Press | Wire Services | Center | Very High | Yes |
| Reuters World | Wire Services | Center | Very High | Yes |
| NPR News | Public Broadcasting | Left-Center | Very High | Yes |
| BBC World | International | Left-Center | High | No |
| The Guardian World | International | Left-Center | Mixed | Yes |
| PBS NewsHour | Public Broadcasting | Center | High | Yes |
| Wall Street Journal | Business | Right-Center | High | Yes |
| The Economist | International | Center | High | No |

*Ratings source: [Media Bias/Fact Check](https://mediabiasfactcheck.com/)*

---

## Database Schema

### feeds
```sql
id, name, url, category, bias, factual, author_url_pattern,
enabled, last_fetched, created_at
```

### articles
```sql
id, feed_id, title, link, summary, published, author,
noise_score, is_read, is_hidden, created_at
```

### filter_keywords
```sql
id, keyword, weight, is_active, created_at
```

### settings
```sql
key, value
```

---

## Article Grading System

Articles receive an objectivity score (0-100) where **higher = better**.

**Grades:**
| Score | Grade | Label | Color |
|-------|-------|-------|-------|
| 85-100 | A | Straight News | Dark green |
| 65-84 | B | Light Commentary | Green |
| 45-64 | C | Editorialized | Yellow |
| 25-44 | D | Heavy Spin | Orange |
| 0-24 | F | Opinion/Hype | Red |

**Deductions (subtracted from 100):**
| Factor | Deduction | Examples |
|--------|-----------|----------|
| Opinion URL patterns | -40 | /opinion/, /editorial/, /blog/ |
| Opinion title indicators | -35 | "Opinion:", "Editorial:" |
| Sensational keywords | -5 to -15 each | "BREAKING", "slams", "destroys" |
| Clickbait patterns | -20 | "10 reasons...", "You won't believe" |
| Excessive punctuation | -5 to -15 | Multiple !!!, ??? |
| ALL CAPS words | -5 to -15 | Non-abbreviation capitals |

**What Gets Analyzed:**
| Input | Checks |
|-------|--------|
| URL | Opinion path patterns |
| Headline | All checks except URL patterns |
| Summary | Sensational keywords, custom keywords |

---

## Implementation Status

### Phase 1: Foundation - COMPLETE
- [x] Set up project structure
- [x] Create SQLite database schema
- [x] Implement storage.py (CRUD operations)

### Phase 2: Data Ingestion - COMPLETE
- [x] Implement feeds.py (RSS fetching/parsing)
- [x] Create config.py with default sources
- [x] Test feed fetching with sample sources

### Phase 3: Filtering - COMPLETE
- [x] Implement filters.py
- [x] Source-based filtering
- [x] URL path filtering (opinion detection)
- [x] Sensationalism keyword scoring

### Phase 4: User Interface - COMPLETE
- [x] Create basic Tkinter window layout
- [x] Feed list panel (left)
- [x] Article list panel (center)
- [x] Article preview panel (bottom)
- [x] Open in browser functionality

### Phase 5: User Controls - COMPLETE
- [x] Add/remove feed sources
- [x] Noise threshold slider
- [x] Mark articles read/unread
- [x] Manual refresh button

### Phase 6: Polish - COMPLETE
- [x] Auto-refresh on interval
- [x] Search/filter articles
- [x] Settings persistence
- [~] Keyboard shortcuts (implemented, needs refinement)

### Phase 7: Bias Transparency - COMPLETE
- [x] Add bias/factual ratings to feeds
- [x] Display bias column in article list
- [x] Color-coded labels in preview
- [x] Author bio URL generation

---

## Progress Log

### Session 1 - 2026-01-17: Planning
- Defined project requirements
- Chose technology stack
- Designed architecture
- Planned filtering strategy
- Created implementation roadmap

### Session 2 - 2026-01-17: Full Implementation
- Created all core modules: config.py, storage.py, feeds.py, filters.py, app.py, main.py
- Implemented complete GUI with three-panel layout
- Added all filtering logic (opinion detection, sensationalism scoring)
- Created Windows batch launcher
- Initial default feeds: AP, Reuters, NPR, BBC, Guardian, PBS, Al Jazeera, CSM

### Session 3 - 2026-01-17: Bias Transparency Update
- Researched journalistic integrity ratings for all sources
- Removed Al Jazeera (Qatar state-owned, mixed factual rating)
- Removed Christian Science Monitor (user request)
- Added Wall Street Journal (Right-Center, High factual)
- Added The Economist (Center, High factual)
- Added bias/factual fields to database with migration support
- Added Bias column to article list
- Added color-coded bias/factual labels in preview panel
- Implemented Author Bio button with auto-generated URLs
- Updated PROJECT_LOG.md

### Session 4 - 2026-01-18: Grading System Overhaul
- Changed auto-refresh interval from 30 minutes to 3 hours
- Replaced "Noise Score" with letter grade system (A-F)
- Inverted scoring: higher = better (0-100 objectivity scale)
- Added grade labels: A (Straight News), B (Light Commentary), C (Editorialized), D (Heavy Spin), F (Opinion/Hype)
- Color scale: dark green → green → yellow → orange → red
- Renamed UI: "Noise Filter" → "Min Grade" slider
- Updated storage queries to filter by minimum score
- Initialized git repository (pending: configure user identity)

### Session 5 - 2026-01-18: Cyberpunk UI Overhaul
- Implemented dark mode with cyberpunk aesthetic
- Color palette: neon cyan (#00ffff) + neon magenta (#ff00ff) accents
- Deep black backgrounds with layered depth
- Cyan borders for Feeds/Articles panels, magenta for Preview panel
- Buttons: cyan border, magenta on hover
- Selected rows: magenta with white text
- Menu highlights: magenta
- Added compact-but-comfortable padding throughout
- Increased row height to 30px for easier clicking
- Added alternating row striping (subtle background variation)

### Session 6 - 2026-01-22: Volume Reduction & Summary Highlighting
- Implemented all three volume reduction features:
  - Recency Window dropdown (6h/12h/24h/48h/Week/All)
  - Smart Daily Cap per Source dropdown (5/10/15/20/No Limit)
  - Topic Clustering with [+N] indicators and RELATED ARTICLES section
- Added cyberpunk animations: pulsing borders, color cycling, status bar typing
- Implemented summary highlighting with semantic colors:
  - Names/proper nouns (cyan), Organizations (green), Locations (lime)
  - Numbers (magenta), Percentages/Quotes (yellow), Actions (hot pink)
- Bold lede (first sentence) for quick scanning
- Typewriter effect for summary text
- Keyboard navigation (Tab, arrows, Enter, M, H, Escape, F5)
- Controls button showing keyboard reference
- **Note:** Keyboard navigation simplified in Session 7

### Session 7 - 2026-01-23: Bug Fixes & Scoring Enhancements
- **Fixed AP & Reuters feeds**: Original URLs were dead (403/404 errors)
  - Updated to use Google News RSS proxy: `news.google.com/rss/search?q=when:24h+allinurl:{domain}`
  - Updated both config.py (for new installs) and existing database records
- **Fixed Bias/Factual ratings**: Database had "Unknown" values
  - Populated all feeds with correct bias/factual ratings from Media Bias/Fact Check
  - Updated migration to auto-populate ratings for feeds with "Unknown" values
- **Fixed Author Info button**: Renamed from "Author Bio", now uses Google search
  - Changed from unreliable URL slug generation to Google search: `"Author Name" author site:domain`
  - Cleans author names (removes "By", locations, titles)
  - Skips agency bylines (AFP, Reuters, AP, etc.)
  - Added visible disabled state (muted colors) to TButton style
- **Simplified keyboard navigation**: Removed Tab/panel cycling
  - Just ↑/↓ to navigate articles, Enter to open, M to toggle read, H to hide
- **Expanded summary analysis**: Added positive/negative factor scoring
  - Positive: attribution (+5), quotes (+5), numbers (+3), dates (+3), hedging (+2)
  - Negative: opinion phrases (-10), imperatives (-8), vague sources (-5), emotional words (-5)
- **Source factual rating modifier**: Feeds' factual ratings now affect scores
  - Very High: +5 bonus, High: neutral, Mostly Factual: -5, Mixed: -10
- **Cross-source corroboration**: Clustered articles get bonus
  - 2 sources: +2, 3 sources: +5, 4+ sources: +8
- **New grade labels**: Cyberpunk-themed, harsher descriptors
  - A: Solid, B: Passable, C: Weak, D: Noise, F: Slop
- **Numerical scoring**: Changed from letter grades to "85 - Solid" format
- **Published column**: Renamed from "Date", now shows relative time
  - Format: "<3 Hours" or ">5 Hours" (rounded to nearest hour)
- **Added WRFDR logo**: Displays at bottom of Feeds panel with version number
- **Relocated status bar**: Moved from bottom of window to Preview panel header
  - "Preview" label on left, animated status text on right
  - Fixed cursor blink to use color toggle (prevents text jumping)
- **UI adjustments**: Increased default window size to 1200x750

### Session 8 - 2026-01-24: UI Tweaks, Wikipedia Hyperlinks, Author Search & Favicons
- **Removed Min Grade slider** from toolbar (all articles now shown regardless of score)
- **Number highlighting expanded** - All numbers now highlighted in magenta, not just those with qualifiers
- **Wikipedia hyperlinks on proper nouns** - Names, organizations, and locations are now clickable
  - Underlined styling with hand cursor on hover
  - Uses Google site:wikipedia.org search, resolves redirect programmatically to bypass notice
  - Extensive exclusion list for common words (days, months, verbs, adjectives, etc.)
  - Multi-word names like "President Kennedy" work correctly
  - **Status:** Functional but disambiguation still inconsistent; tabled for future refinement
- **Search Author dropdown** - Replaced "Author Info" button with dropdown menu
  - Options: Google, LinkedIn, Wikipedia, Twitter
  - Extracts and cleans author name from article metadata
  - Styled with cyan border to match other buttons
- **Feed favicons** - Small icons now display next to feed names in sidebar
  - Uses Google's favicon service for reliability
  - Handles Google News RSS proxy URLs (extracts real domain)
  - Handles feed subdomains (feeds.npr.org → npr.org, bbci.co.uk → bbc.com)
  - Cached in database as BLOB, loaded async in background

### Session 9 - 2026-01-25: WIREFEEDR Rebrand & Borderless UI Overhaul (LOST - NEEDS REBUILD)
- **App renamed to WIREFEEDR** - New name displayed in custom title bar and taskbar
- **Fixed ticker tape click-to-select bug** - Clicking articles in ticker now works with clustering
  - Root cause: Only representative article IDs were in treeview, not clustered articles
  - Solution: Added `article_to_rep` reverse lookup map to resolve any article ID to its cluster representative
- **Fixed borderless window issues**:
  - **Taskbar visibility**: Used Windows ctypes API (`WS_EX_APPWINDOW`) to force app onto taskbar
  - **Resize handles**: Implemented custom edge detection with 8-direction resize cursors
- **Removed native Windows menu bar** - Eliminated white "File/Articles" menu bar
- **Custom title bar menus** - Moved all menu functionality into draggable title bar:
  - **REFRESH** button (first position) with spinning animation on click
  - **FEEDS** dropdown (includes Feed Diag)
  - **CONTROLS** dropdown with styled popup matching app aesthetic
  - **PURGE** button (aligned right near minimize) with custom confirmation dialog
- **Custom PURGE confirmation dialog** - Styled borderless popup:
  - Magenta border, dark background, "WARNING" in large text
  - Centered over main window, matches cyberpunk aesthetic
  - Added `delete_all_articles()` method to storage.py
- **Relocated toolbar controls** - Moved filters inline with panel headers to save vertical space:
  - Feeds header row: "Feeds" label left, "Show Read" + "Cluster" checkboxes right
  - Articles header row: "Articles" label left, Recency/Per Source/Search controls right
- **Fixed panel border animations** - Refactored `BorderAnimator` class:
  - Switched from ttk.LabelFrame to tk.Frame for panels
  - Changed from ttk.Style updates to direct widget `configure()` calls
  - Added `set_targets()` method to accept frame/label references
- **Code cleanup** - Removed ~40 lines of unused code:
  - Removed obsolete LabelFrame styles
  - Removed `_build_toolbar` method
  - Removed `_build_status_bar` method
  - Removed `show_delete_old_dialog` method
  - Kept `analyze_article` debug method per user request

### Session 10 - 2026-01-25: Accidental Revert
- Attempted font consistency changes (Segoe UI sans-serif)
- User requested revert, but `git checkout` reverted to staged Session 8 version
- **ALL Session 5-9 work lost** (dark theme, animations, borderless window, ticker, etc.)
- Current state: Basic unstyled app from Session 4

### Session 11 - 2026-01-25: Core Functionality Rebuild & Entity Highlighting System
Prioritized functionality over aesthetics. Rebuilt core features and implemented comprehensive entity recognition.

**Volume Reduction Controls Restored:**
- Recency dropdown (6h/12h/24h/48h/Week/All)
- Per Source cap dropdown (5/10/15/20/No Limit)
- Topic Clustering toggle with [+N] indicators
- Related articles shown in preview when cluster selected

**Scoring System Improvements:**
- Score column displays "85 - Solid" format
- Date column shows relative time ("< 3 Hours", "2 Days")
- Factual rating now factors into objectivity scoring
- Top 10 articles per feed at fetch time (ranked by quality)

**AP/Reuters Feed Fix:**
- Database migration auto-fixes old broken URLs to Google News RSS proxy

**Search Author Dropdown:**
- Replaced "Author Bio" button with dropdown menu
- Options: Google, LinkedIn, Wikipedia, Twitter/X
- Cleans author names, skips agency bylines

**Feed Favicons:**
- 16x16 icons next to feed names in sidebar
- Google favicon service, cached in database
- Handles Google News proxy URLs (extracts real domain)

**Keyboard Navigation:**
- ↑/↓ navigate articles, Enter opens in browser
- M toggles read/unread, H hides article, F5 refreshes

**Comprehensive Entity Highlighting System (Wikipedia Links):**
New category-based highlighting with clickable Wikipedia links. Entity databases massively expanded.

| Category | Color | Entries | Examples |
|----------|-------|---------|----------|
| People | Cyan `#008b8b` | Pattern-based | Names detected mid-sentence |
| Titles | Purple `#8b008b` | ~150 | President, General, Dr. |
| Government | Slate Blue `#6a5acd` | ~200 | FBI, Congress, Kremlin |
| Military | Steel Blue `#4682b4` | ~180 | NATO, IDF, Navy SEALs |
| Organizations | Green `#228b22` | ~350 | UN, Apple, Harvard |
| Countries | Orange `#cc7000` | ~200 | All 195 UN nations + aliases |
| Places | Sienna `#a0522d` | ~450 | Major cities worldwide, landmarks |
| Events | Goldenrod `#b8860b` | ~250 | Wars, treaties, disasters |

**Number Highlighting (non-clickable):**
| Category | Color | Examples |
|----------|-------|----------|
| Money | Magenta `#c71585` | $5 billion, €200 million |
| Statistics | Hot Pink `#ff69b4` | 45%, 1,000 troops |
| Dates | Rose `#e75480` | January 6, Tuesday |
| Numbers | Yellow `#e6c300` | All other numbers |
| Verbs | Muted Coral `#d2956b` | said, announced, killed |

**Entity Detection Features:**
- Title + Name linked as one unit ("President Xi Jinping" → Wikipedia)
- Multi-word pattern matching ("Bureau of Meteorology", "Gulf of Mexico")
- Trigger word whitelist prevents over-matching
- Blacklist for common phrase endings
- Possessives handled ("China's" highlights but searches "China")
- Names at sentence start now detected
- Bold lede (first sentence)
- ~1,780 total entity entries across all categories

**Remaining for Future Sessions:**
- Borderless window with custom title bar
- Pulsing border animations
- WIREFEEDR branding
- **Back up to GitHub** (priority)

### Session 12 - 2026-01-27: Dark Cyberpunk Theme & Ticker Tape
Restored the dark cyberpunk aesthetic lost in Session 10, plus the ticker tape from Session 9.

**Dark Theme Applied to All Widgets:**
- Switched ttk theme from Windows default to `clam` for full color control
- Configured all ttk styles: TFrame, TLabel, TButton, TCheckbutton, TCombobox, Treeview, Treeview.Heading, TLabelframe, TPanedwindow, TSeparator, TScrollbar, TMenubutton, TEntry, TSpinbox
- `style.map()` calls for interactive states: magenta hover, magenta selection, cyan active indicators
- Root window background set to deepest black (`#05050a`)

**Color Palette (from config.py DARK_THEME):**
- Backgrounds: `#05050a` (deepest), `#0a0a12` (panels), `#10101a` (lists/inputs)
- Text: `#e8e8e8` (primary), `#6a7080` (muted), `#ffffff` (highlight)
- Accents: `#00ffff` (cyan), `#ff00ff` (magenta), `#ff1493` (hot pink)
- Selection: magenta background with white text

**Specific Widget Fixes:**
- All 7 `tk.Menu` constructors (menubar, submenus, context menus, author menu) dark-themed
- Combobox popdown listbox styled via `option_add` (dark bg, magenta selection)
- Checkbutton indicators: dark background, cyan when selected
- Treeview tags: unread = bold bright white, read = muted `#6a7080`
- Preview text widget: dark bg with light text and cyan cursor
- Bias/factual `tk.Label` widgets: dark background to blend when empty
- All three dialog classes (AddFeed, ManageFeeds, FilterKeywords) dark-themed
- Dialog status colors: `#ff4444` (error), `#44ff44` (success), muted gray (info)
- Border colors (`bordercolor`, `lightcolor`, `darkcolor`) set on buttons, entries, treeviews, labelframes to eliminate white edges

**Ticker Tape Restored:**
- Scrolling cyan headlines from unread articles
- Magenta highlight on hover, click to select, double-click to open
- Seamless looping with dual-copy technique
- Pause on mouse enter, resume on leave

### Session 13 - 2026-01-28: Cyberpunk UI Overhaul — Borderless Window, Animations & Taskbar Icon
Full visual overhaul making the app feel like a cyberpunk terminal application.

**Borderless Window with Custom Title Bar:**
- Removed native Windows chrome via `overrideredirect(True)` on a `Toplevel` window
- Custom 32px title bar: LOGO.png + "WIREFEEDR" branding (Consolas 14 bold, cyan)
- Title bar menu labels: FILE, FEEDS, ARTICLES, SETTINGS — click opens dark popup menus
- Window controls: minimize (─), maximize (□), close (✕) using Segoe UI Symbol font
- Hover effects: cyan dim for min/max, red for close
- Drag-to-move and double-click-to-maximize on title bar
- Bottom-right resize grip for manual window resizing

**Taskbar Presence with Custom Icon:**
- Hidden owner `tk.Tk()` window pattern — provides taskbar button for `overrideredirect` Toplevel
- `SetCurrentProcessExplicitAppUserModelID` so Windows uses app icon instead of python.exe
- `SetProcessDpiAwareness` for crisp rendering on high-DPI displays
- Generated bold cyan "W" icon with magenta shadow (PIL) — reads clearly at all taskbar sizes
- Each ICO size (256/64/48/32/24/16) individually LANCZOS-resampled

**Unified 30fps Animation Loop:**
- Single `_anim_tick()` method drives all animations via `after(33)`
- Replaces separate `after()` calls for ticker — `_ticker_step()` no longer self-schedules
- Frame counter (0–3599) used by all animation calculations

**Pulsing Neon Borders:**
- Panels converted from `ttk.LabelFrame` to `tk.LabelFrame` for per-widget `highlightbackground`
- Sine-wave interpolation between dim/bright colors via `_lerp_color()` helper
- Different cycle periods: Feeds ~3s (90 frames), Articles ~4s (120 frames), Preview ~5s (150 frames)
- Feeds & Articles pulse cyan, Preview pulses magenta

**Title Glow:**
- "WIREFEEDR" label color cycles cyan ↔ magenta on a slow 6-second sine wave

**Magenta Neon Sweep Line:**
- 2px Canvas underneath title bar with sweeping magenta glow
- Ping-pong pattern (left→right→left) over ~8 seconds, no hard reset
- Canvas rectangle items created once and reused via `itemconfigure` for smooth rendering

**Cyberpunk Status Bar:**
- Terminal-style `>> READY` prefix on all status messages (uppercased)
- Blinking block cursor (█) on the right side
- Digital clock (HH:MM:SS) in Consolas font

**Boot Sequence:**
- Canvas overlay on launch with typewriter-style lines (300ms each):
  - `>> WIREFEEDR v1.9`
  - `>> INITIALIZING NEURAL FEED PARSER...`
  - `>> CONNECTING TO NEWS GRID...`
  - `>> BIAS DETECTION MATRIX: ONLINE`
  - `>> SIGNAL LOCKED. WELCOME, OPERATOR.`
- Overlay auto-removes, then animation loop starts

**Restructured Build Pipeline (`__init__`):**
```
_setup_styles()
_build_title_bar()        # Custom chrome
_build_menus()            # Popup menus (replacing native menubar)
_bind_shortcuts()         # Keyboard bindings
_build_toolbar()
_build_ticker()
_build_main_layout()      # Panels now tk.LabelFrame
_build_status_bar()       # Cyberpunk terminal style
_build_resize_grip()      # Bottom-right handle
_play_boot_sequence()     # Typewriter intro → starts animation loop
```

**Entry Point Change (`main.py`):**
- `app._owner.mainloop()` — mainloop runs on hidden owner, not the Toplevel

### Session 14 - 2026-01-28: Comprehensive Highlighting & UI Polish

**Highlighting System Overhaul:**
- All mid-sentence capitalized words now highlighted as proper nouns (electric mint #00ffa0)
- Expanded number patterns: ordinals (1st, 250th), times, ranges, decades, units, K/M/B, Roman numerals
- 17 color-coded verb categories with thematic colors (crimson=accusation, gold=legal, forest green=economic)
- British spelling variants for all verbs (criticised, organised, recognised, etc.)
- ~600 verbs across categories with -ing forms

**Entity Database Expansion:**
- Tech acronyms: AI, ML, LLM, VR, blockchain, cybersecurity terms (~100 entries)
- Tech companies: expanded from ~40 to ~200 (AI companies, semiconductors, fintech, etc.)
- Heads of state: 400+ world leaders with name variants (current + historical)
- US historical figures: all presidents, founding fathers, civil rights leaders, Supreme Court justices, military leaders, congressional leaders

**UI Improvements:**
- Darker backgrounds (#020206) for maximum neon contrast
- "X/Y READ" counter in Articles panel header
- Idle status cycling with 32 cyberpunk messages ("RETICULATING SPLINES...", etc.)
- Typewriter effect on idle status messages

**Fixes:**
- Arrow key navigation bound directly to treeview (fixes skip issue)
- Auto-cleanup: articles purged every 48 hours (was manual)
- Removed OPML from roadmap (out of scope)

### Session 15 - 2026-01-28: UI Overhaul & Neon Border Frame

**Menu Consolidation:**
- Removed File, Feeds, Articles menus — all moved to unified Settings menu
- Settings contains: Feeds submenu, Articles submenu, Recency, Per Source, Cluster Topics, Filter Keywords
- Title bar removed — window controls (−, □, ✕) moved to toolbar

**Toolbar Redesign:**
- Left: Refresh, Mark All Read, Show Read checkbox
- Right: Settings button, Filter (real-time), Clear, window controls
- Drag-to-move window via toolbar

**Neon Border Frame:**
- 2px animated border around entire window (replaces top-only sweep line)
- Two waves chase each other: cyan and magenta, 180° apart
- ~10 second full cycle around perimeter
- Segments recalculate on resize

**UI Polish:**
- Scrollbars: bright cyan thumb, magenta on hover
- Progress bar: 20 segmented blocks, magenta→cyan gradient, percentage readout
- Status bar: "..." prefix typed out, 110 cyberpunk messages, random intervals (3-12s)
- WIREFEEDR logo + v2.0 moved to bottom of Feeds panel
- Summary panel scrollbar fixed (now on right side)

**Clustering & Related Articles:**
- More aggressive clustering (threshold 0.06, bigrams added)
- Related articles highlighted in neon yellow
- Clickable related articles — click to navigate to that article
- "Click to Read" instruction under RELATED ARTICLES header

**Other Changes:**
- Auto-refresh: 1 hour (was 3 hours)
- Single instance: new launch closes previous instance (socket-based)
- Real-time filter: type to filter articles instantly

**Final Polish:**
- Logo: switched to taskbar icon (icon_preview.png), enlarged to 28px
- Logo clickable: opens Patreon with "Patreon" tooltip on hover
- WIREFEEDR text: 16pt bold to span Feeds panel width
- Status messages: expanded from 110 to 270 with new categories:
  - Blade Runner (Voight-Kampff, replicants, Nexus-6)
  - Ghost in the Shell (cyberbrains, Section 9, thermoptic camo)
  - Hacker culture (phreaking, wardialers, rainbow tables)
  - AI/ML ops (transformers, RLHF, hallucinations)
  - News/media (astroturf, echo chambers, bot detection)
  - Retro computing (punch cards, HIMEM.SYS, floppy disks)

### Session 16 - 2026-01-29: Diagonal Gradient Effects

**Diagonal Gradient System (PIL-based):**
- New `_create_gradient_image()` helper using PIL diagonal line drawing
- Returns `ImageTk.PhotoImage` stored in `_gradient_cache` to prevent GC
- Color blends from top-left (color1) to bottom-right (color2) along anti-diagonals

**Toolbar Gradient Background:**
- Container frame with gradient Canvas placed behind widgets via `place()`
- Gradient: dark cyan-tint (`#0a1028`) → dark magenta-tint (`#280a18`)
- All widgets remain in a standard Frame for reliable layout
- Drag bindings on both canvas and frame for full coverage

**Panel Header Gradient Bars:**
- 20px Canvas strips inside FEEDS, ARTICLES, and PREVIEW panels
- LabelFrame `text=""` — headers now rendered via `create_text()` on gradient canvas
- Feeds & Articles: cyan-tinted gradient (`#0a1028` → `#1a0a20`)
- Preview: magenta-tinted gradient (`#1a0a28` → `#280a18`)
- `_update_read_counter()` now updates canvas text directly for "X/Y READ" display

**Border Wave Diagonal Gradient:**
- Each border segment stores a diagonal factor based on `(x+y)/(w+h)`
- Top-left segments (factor≈0) glow cyan, bottom-right (factor≈1) glow magenta
- Both chase waves use the same position-based color blend
- Smooth color transition around entire perimeter using existing `_lerp_color()`

**Gradient Buttons:**
- New `_create_gradient_button()` creates canvas-based buttons with gradient fill
- Normal state: dark cyan→magenta gradient, cyan text
- Hover state: brighter gradient (`#2a1250` → `#50122a`), white text
- Disabled state: darker muted gradient, secondary text color
- Replaced: Refresh, Mark All Read, Clear, Open in Browser
- Window controls (−, □, ✕) and Settings label unchanged

**Other:**
- Removed redundant noise score from preview panel meta info
- PIL import moved to top level (was previously inline in favicon/icon code)

### Session 17 - 2026-01-30: Modular Architecture Refactor

**app.py Split (5,690 → 1,100 lines, 81% reduction):**
- Extracted 8 focused modules using "pass `app` as parameter" pattern
- Each module defines functions receiving the app instance — no mixins, no circular imports
- Event handlers stay in app.py so callback bindings don't break
- Delegation stubs in app.py (thin `def _method(self): module.function(self)`) preserve UI callback compatibility

**New Modules:**
- `entities.py` (1,330 lines) — pure data: TITLES, KNOWN_PEOPLE, ORGANIZATIONS, COUNTRIES, etc.
- `constants.py` (316 lines) — IDLE_MESSAGES, TRENDING_STOP_WORDS, FLAP_CHARS, BIAS_POSITIONS
- `dialogs.py` (300 lines) — AddFeedDialog, ManageFeedsDialog, FilterKeywordsDialog, instance management
- `highlighting.py` (675 lines) — setup_highlight_tags, apply_highlighting, entity detection
- `window_mgmt.py` (215 lines) — Win32 borderless window, drag/resize, minimize/maximize
- `ui_builders.py` (746 lines) — all _build_* and _setup_* widget construction methods
- `ticker.py` (534 lines) — ticker tape, trending split-flap display, bias balance bar
- `animations.py` (711 lines) — animation loop, visual effects, typewriter, boot sequence, gradient buttons

**UI Tweaks:**
- Preview panel given more vertical space (equal weight with articles panel)
- Refresh button plays .wav sound effect instead of synthesized modem beeps
- Trending words displayed in random order (high-frequency words still color-highlighted)

### Session 18 - 2026-02-01: Critical Feed Fetch Pipeline Fix

**Three silent bugs in fetch pipeline (broken since Session 17 refactor):**

All three errors were swallowed by `except Exception` — status bar reported "Fetched 0 new articles" with no indication of failure.

1. **`fetch_feed()` return type mismatch** — `FeedManager.fetch_feed()` returns a dict `{"success": bool, "articles": [...]}`, but `fetch_all_feeds()` and `_fetch_single_feed()` iterated over it as a list. This looped over dict keys (`"success"`, `"feed_title"`, `"articles"`) instead of actual articles.
   - Fix: Extract `result.get("articles", [])` and check `result.get("success")` before processing.

2. **`add_article()` parameter mismatch** — `storage.add_article()` expects individual parameters `(feed_id, title, link, summary, published, author, noise_score)` but was called with a single dict, which was passed as the `feed_id` int parameter.
   - Fix: Unpack article dict into keyword arguments.

3. **`score_article()` doesn't exist** — Code called `self.filter_engine.score_article(article)` but `FilterEngine` has no such method. The correct method is `calculate_objectivity_score(title, link, summary, factual_rating)` with individual string parameters.
   - Fix: Call `calculate_objectivity_score()` with unpacked fields.

**Both `fetch_all_feeds()` and `_fetch_single_feed()` had all three bugs.**

### Session 19 - 2026-02-02: Ambient Effects & CRT Shutdown Polish

**CRT Shutdown Chromatic Aberration:**
- RGB channel-split effect across all three shutdown phases (vertical compress, horizontal compress, dot fade)
- Red (`#ff4444`) and blue (`#4444ff`) ghost elements offset from the main white/cyan element
- Phase 1: red bar 3px above, blue bar 3px below the compressing bar
- Phase 2: red line 2px above, blue line 2px below the compressing line
- Phase 3: red dot offset up-left, blue dot offset down-right from the fading dot
- All color elements fade toward black alongside the main element

**Title Chromatic Aberration Flicker:**
- WIREFEEDR title rendered on Canvas with red and cyan ghost text offset ±2px
- Random flicker bursts (5s–1min intervals): ghost text jitters ±2px for 6 frames
- Snaps back to rest position after burst

**Header Text Glitch:**
- Rare brief character scramble on panel headers (FEEDS, ARTICLES, PREVIEW, TRENDING)
- 15% per-character replacement with split-flap characters during burst
- ±1px position jitter and occasional magenta color flash
- Random triggers every 15–30 seconds, lasts 8–12 frames

**Matrix Rain on Preview Placeholder:**
- Katakana, Greek, Cyrillic, math symbols, and digits rain down on empty preview panel
- Cyan and magenta color palettes with 5-step trail fade
- Staggered column spawns, variable speed, character mutation every 4 frames
- "SELECT ARTICLE TO VIEW" centered with backdrop rectangle, color-cycling text
- Canvas resize handler rebuilds columns on window resize

**Static Noise Bursts:**
- Random pixel scatter on 1–3 panels (feeds, articles, preview)
- 15–30 small colored frames per panel per frame, 15–25 frame duration
- 90% dim dark colors, 10% cyan/magenta accent
- Triggers every 20–40 seconds

### Session 20 - 2026-02-02: SIGNAL Step 1 — MBFC Data Integration

First SIGNAL infrastructure step: pull publisher credibility data from Media Bias/Fact Check and wire it into the feed pipeline. No UI changes — invisible plumbing for future scoring.

**New module: `mbfc.py` (~150 lines)**
- `load_mbfc_data()` — reads local `data/mbfc_sources.json` into module-level cache on app startup
- `normalize_domain(url)` — extracts bare publisher domain from any URL:
  - Standard URLs: `https://www.apnews.com/article/...` → `apnews.com`
  - Feed subdomains: `feeds.npr.org` → `npr.org`
  - Google News proxy: extracts domain from `allinurl:` query parameter
  - Alias resolution: `bbc.co.uk` → `bbc.com`
- `lookup_source(url)` — returns full MBFC dict (bias, reporting, credibility, questionable flags, traffic, popularity, social handles, MBFC profile URL) or `None`
- `map_bias_to_wirefeedr()` / `map_reporting_to_wirefeedr()` — convert MBFC strings to existing Wirefeedr display values

**New script: `fetch_mbfc.py` (~80 lines)**
- Downloads `combined.json` from `drmikecrowe/mbfcext` GitHub repo (v5)
- Re-indexes 9,773 sources by domain (array → dict)
- Writes to `data/mbfc_sources.json` (2.7MB, gitignored)
- Prints coverage stats: all 8 default feeds matched

**MBFC data per source:**
- `bias`: left, left-center, center, right-center, right, pro-science, conspiracy-pseudoscience, satire, fake-news
- `reporting`: very-high, high, mostly-factual, mixed, low, very-low
- `credibility`: high-credibility, medium-credibility, low-credibility
- `questionable`: array of flags (conspiracy, propaganda, failed-fact-checks)
- Plus: traffic, popularity, facebook, twitter, MBFC profile URL

**App integration:**
- `mbfc.load_mbfc_data()` called in `app.py __init__` — loads in under a second from local JSON
- Both `fetch_all_feeds()` and `_fetch_single_feed()` now call `mbfc.lookup_source(article_link)` and attach result as `article["mbfc"]` dict
- MBFC mapping tables added to `config.py` (`MBFC_BIAS_MAP`, `MBFC_REPORTING_MAP`)

**Coverage results (AP has left-center bias per MBFC, which differs from our manual Center rating — composite scoring in Step 2 will reconcile):**
| Feed | MBFC Domain | MBFC Bias | MBFC Reporting |
|------|-------------|-----------|----------------|
| Associated Press | apnews.com | left-center | high |
| Reuters World | reuters.com | center | very-high |
| NPR News | npr.org | left-center | high |
| BBC World | bbc.com | left-center | mostly-factual |
| The Guardian World | theguardian.com | left-center | high |
| PBS NewsHour | pbs.org | left-center | high |
| Wall Street Journal | wsj.com | right-center | mostly-factual |
| The Economist | economist.com | center | high |

### Session 21 - 2026-02-03: About Dialog & Interactive Sparkline

**About dialog (`dialogs.py`):**
- New `AboutDialog` class matching CredibilityDetailDialog cyberpunk aesthetic
- Gradient header, version (v2.1), tagline ("Facts over noise."), app description
- Clickable links: GitHub Issues, Patreon support
- Credits: KC Bowlan, Claude Opus 4.5
- Menu item added to Settings between Filter Keywords and Exit

**Sparkline enhancements (`dialogs.py`, `storage.py`):**
- Canvas expanded from 200x36 to full-width 440x98 with thicker lines (2px) and larger dots (r=4)
- Auto-scaled Y-axis: maps to actual data range instead of fixed 0-100, making dips and peaks fill the chart
- Labeled axes: Y-axis shows score range, X-axis shows OLDER/NEWER, header shows "CREDIBILITY TREND: domain"
- Interactive dots: hover shows tooltip with article title, composite score, WRFDR/MBFC breakdown and blend formula; click opens article in browser
- New `recent_articles` field in `get_publisher_trend_data()` returns title, link, and score components for each sparkline point

---

## Potential Future Enhancements

### Completed
- [x] **Volume Reduction** - Topic clustering, recency window, smart daily cap per source
- [x] **Keyboard shortcuts** - ↑/↓ navigate, Enter open, M read, H hide
- [x] **Wikipedia hyperlinks** - Comprehensive entity highlighting with ~1,780 entries
- [x] **Ticker tape** - Scrolling unread headlines with click/hover interaction
- [x] **Borderless window** - Custom title bar, drag-to-move, taskbar icon
- [x] **Pulsing border animations** - Sine-wave neon borders, title glow, sweep line
- [x] **GitHub backup** - Repository at github.com/kcbowlan/wirefeedr
- [x] **Feed favicons** - 16x16 icons next to feed names
- [x] **Author search** - "Search Author" dropdown (Google, LinkedIn, Wikipedia, Twitter)
- [x] ~~OPML import/export~~ - Out of scope (convenience, not quality filtering)
- [x] **Empty preview area state** - Matrix rain with "SELECT ARTICLE TO VIEW" placeholder
- [x] **Boot screen typewriter effect** - Boot text types in character-by-character
- [x] **Easter eggs** - Konami code triggers glitchy "ACCESS DENIED" terminal overlay

---

## Priority 1: SIGNAL — Source Integrity, Grading, Noise Abatement & Legitimacy

> All SIGNAL tasks take precedence over Secondary items. SIGNAL directly advances the core mission: separating factual news from noise.

**Credibility Scoring Feature (from spec):**
- [x] **Pull and examine MBFC data** - 9,773 sources from `drmikecrowe/mbfcext` v5 (2.7MB JSON)
- [x] **Build domain normalization** - Handles subdomains, Google News proxy URLs, alias resolution
- [x] **Create local MBFC JSON lookup** - `data/mbfc_sources.json` re-indexed by domain; no runtime internet dependency
- [x] **Match MBFC against current feeds** - 8/8 default feeds matched
- [x] **Build composite scoring (40/60 blend)** - 40% MBFC publisher baseline + 60% Wirefeedr per-article analysis; fall back to 100% Wirefeedr when no MBFC data
- [x] **Add score to article feed UI** - Single clickable score per article, cyberpunk aesthetic; optional confidence indicator when MBFC data unavailable
- [x] **Build credibility detail panel** - Click score to expand: article-level (objectivity, sensationalism, opinion flags) + publisher-level (bias position, factual level, credibility rating)
- [x] **Add per-article credibility logging** - Store publisher, author, date, scores, flags in SQLite for historical accumulation
- [x] **Implement rolling averages and trends** - 90-day publisher rolling average, per-author average, anomaly flag for outlier articles; minimum 10 articles before showing trends
- [x] **Add About section** - "Facts over noise" copy, Patreon link, GitHub Issues link, credits (v2.1, KC Bowlan + Claude Opus 4.5)

**SIGNAL Infrastructure:**
- [ ] **Async feed fetching** - Currently sequential in background thread; faster fetching means fresher data from more sources
- [ ] **Evaluate new feeds via scoring system** - Use existing bias/factual/noise scoring to identify and add high-quality sources
- [ ] **Feed health monitoring dashboard** - Track feed reliability, uptime, and quality over time
- [ ] **Notification for new articles** - Ensures important stories aren't missed

**SIGNAL Research & Expansion:**
- [ ] **Author credibility in article scores** - Tie author reputation into scoring more reliably; prefer offline solutions; investigate journalist credibility/bias databases
- [ ] **Additional bias/credibility tracking sources** - Find sources beyond MBFC that track publisher bias and credibility; ping periodically and update; visualize rating shifts over time as line graphs
- [ ] **Ground News methodology** - Research their approach (bias ratings, coverage analysis, blind spot detection) and evaluate what fits without compromising project goals

**SIGNAL-Adjacent** (supports SIGNAL goals indirectly):
- [ ] **Feed folders/grouping** - Organize feeds for scaling to more sources
- [ ] **Article tagging/bookmarking** - Tagged articles provide ground truth for scoring refinement

### Priority 2: Secondary
Polish, aesthetics, and convenience features. Only work on these when SIGNAL tasks are blocked or need a break.

- [ ] **Subtler refresh animation** - Current animation on refresh is too aggressive
- [ ] **Non-standard UI exploration** - Explore UI paradigms outside typical Windows conventions
- [ ] **Database backup/restore**
- [ ] Offline reading mode (cache full article text)
- [ ] Readability mode (strip ads, extract content)
- [ ] Integration with read-it-later services (Pocket, Instapaper)

---

## Known Limitations

1. **WSJ Feed**: Dow Jones RSS may require authentication for full article content
2. **RSS Compatibility**: Some non-standard feeds may not parse correctly
3. **Windows Only**: Batch launcher is Windows-specific (Python command works cross-platform)
4. **Author Bio URLs**: Best-effort generation; some may 404 if slug format differs from expected

---

## Notes & Decisions

- **Why not AI-based filtering?** Keyword/rule-based filtering keeps the app simple, fast, and fully offline. Can add AI later if needed.
- **Why hide vs delete?** Hiding allows users to tune sensitivity without losing articles. Transparency over black-box filtering.
- **Why these default sources?** Selected for factual reporting track record per Media Bias/Fact Check. Balanced across political spectrum (Left-Center to Right-Center).
- **Why color-coded bias?** Quick visual indication helps users contextualize information before reading.
